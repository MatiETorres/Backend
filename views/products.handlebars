<h2>Productos (PÃ¡gina {{page}} / {{totalPages}})</h2>
<ul id="productsList">
  {{#each products}}
    <li>
      <a href="/products/{{this._id}}">{{this.title}}</a> - ${{this.price}} - {{this.category}}
      <button onclick="addToCart('{{this._id}}')">Agregar al carrito</button>
    </li>
  {{/each}}
</ul>

<div>
  {{#if hasPrev}}<a href="?page={{prevPage}}">Prev</a>{{/if}}
  {{#if hasNext}}<a href="?page={{nextPage}}">Next</a>{{/if}}
</div>

<script>
async function addToCart(pid){
  let cartId = localStorage.getItem('cartId');
  if(!cartId){
    const res = await fetch('/api/carts', { method: 'POST' });
    const data = await res.json();
    cartId = data._id || data.id;
    localStorage.setItem('cartId', cartId);
  }
  await fetch(`/api/carts/${cartId}/product/${pid}`, { method: 'POST' });
  alert('Producto agregado al carrito');
}
</script>
